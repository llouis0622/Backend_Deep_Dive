## 10. 스프링 AOP 구현

### 1. 스프링 AOP 구현
- @Aspect -> 스프링 AOP 사용
- @Around -> 포인트컷 표현식 직접 넣어 사용
- @Pointcut -> 포인트컷 별도 분리 가능
- 포인트컷 공용 사용 -> 별도의 외부 클래스에 분리 가능
- 하나의 애스펙트에 여러 어드바이스 -> 순서 보장 불가
- 애스펙트 별도의 클래스로 분리 -> 순서 보장 가능
- 어드바이스
  - @Around : 메서드 호출 전후에 수행, 가장 강력한 어드바이스, 조인 포인트 실행 여부 선택, 반환 값 변환, 예외 변환
  - @Before : 조인 포인트 실행 이전 실행
  - @AfterReturning : 조인 포인트가 정상 완료 후 실행
  - @AfterThrowing : 메서드가 예외를 던지는 경우 실행
  - @After : 조인 포인트가 정상 또는 예외에 관계없이 실행

## 11. 스프링 AOP - 포인트컷

### 1. 포인트컷 지시자
- 포인트컷 지시자(PCD, Pointcut Designator)
  - execution
  - withdin
  - args
  - this
  - target
  - @target
  - @within
  - @annotation
  - @args
  - bean

### 2. execution
- 메서드 실행 조인 포인트 매칭, 스프링 AOP에서 가장 많이 사용
- `execution(접근제어자? 반환타입 선언타입?메서드이름(파라미터) 예외?)`
- 매칭 조건 : 접근제어자, 반환타입, 선언타입, 메서드 이름, 파라미터, 예외

### 3. within
- 특정 타입 내의 조인 포인트 매칭
- execution에서 타입 부분만 사용

### 4. args
- 인자가 주어진 타입의 인스턴스인 조인 포인트
- execution의 args 부분과 동일
- 부모 타입 허용, 실제 넘어온 파라미터 객체 인스턴스로 판단

### 5. @target, @within
- @target
  - 실행 객체의 클래스에 주어진 타입의 어노테이션이 있는 조인 포인트
  - 인스턴스의 모든 메서드를 조인 포인트로 적용
- @within
  - 주어진 어노테이션이 있는 타입 내 조인 포인트
  - 해당 타입 내에 있는 메서드만 조인 포인트로 적용

### 6. @annotation, @args
- @annotation : 메서드가 주어진 어노테이션을 가지고 있는 조인 포인트 매칭
- @args : 전달된 실제 인수의 런타임 타입이 주어진 타입의 어노테에션을 갖는 조인 포인트

### 7. bean
- 스프링 전용 포인트컷 지시자, 빈의 이름으로 포인트컷 지정

### 8. 매개변수 전달
- 포인트컷 표현식을 사용해서 어드바이스에 매개변수 전달 가능
  - this, target, args, @target, @within, @annotation, @args

### 9. this, target
- this : 스프링 빈 객체를 대상으로 하는 조인 포인트
- target : Target 객체를 대상으로 하는 조인 포인트

## 12. 스프링 AOP - 실무 주의사항

### 1. 프록시와 내부 호출 - 문제
- AOP 적용 -> 프록시로 대상 객체 호출
- 대상 객체 내부에서 메서드 호출 발생 -> 프록시를 거치지 않고 대상 객체 직접 호출
- 프록시 방식 AOP -> 메서드 내부 호출에 프록시 적용 불가

### 2. 프록시와 내부 호출 - 대안
- 자기 자신 주입
- 지연 조회
- 구조 변경

### 3. 프록시 기술과 한계 - 타입 캐스팅
- JDK 동적 프록시 한계 : 구체 클래스로 타입 캐스팅이 불가능
- CGLIB 프록시 -> 대상 객체 캐스팅 가능

### 4. 프록시 기술과 한계 - 의존관계 주입
- JDK 동적 프록시를 구체 클래스 타입에 주입 -> 타입 관련 예외 발생
- CGLIB 프록시를 구체 클래스 타입에 주입 -> 정상 동작

### 5. 프록시 기술과 한계 - CGLIB
- 대상 클래스에 기본 생성자 필수
- 생성자 2번 호출 문제
- final 키워드 클래스, 메서드 사용 불가

### 6. 프록시 기술과 한계 - 스프링의 해결책
- 스프링 3.2, CGLIB 스프링 내부 패키징
- CGLIB 기본 생성자 필수 해결 -> 특별한 라이브러리 사용
- 생성자 2번 호출 문제 -> 특별한 라이브러리 사용