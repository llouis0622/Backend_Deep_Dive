## 4. 프록시 패턴과 데코레이터 패턴

### 1. 프로젝트 생성
- v1 -> 인터페이스와 구현 클래스 - 스프링 빈으로 수동 등록
- v2 -> 인터페이스 없는 구체 클래스 - 스프링 빈으로 수동 등록
- v1 -> 컴포넌트 스캔으로 스프링 빈 자동 등록

### 2. 프록시, 프록시 패턴
- 클라이언트 : 서버에 필요한 것 요청
- 서버 : 클라이언트 요청 처리
- 프록시 : 어떤 대리자를 통해 간접적으로 서버에 요청하는 것
  - 접근 제어 : 권한에 따른 접근 차단, 캐싱, 지연 로딩
  - 부가 기능 추가 : 원래 서버가 제공하는 기능에 더해서 부가 기능 수행
- 프록시 패턴 : 접근 제어가 목적

### 3. 데코레이터 패턴
- 데코레이터 패턴 : 원래 서버가 제공하는 기능에 더해서 부가 기능 수행
- 응답 값을 꾸며줌
- 실행 시간을 측정함

### 4. 프록시 패턴과 데코레이터 패턴 정리
- GOF 데코레이터 패턴
  - Component
    - RealComponent
    - Decorator
      - TimeDecorator
      - MessageDecorator
- 프록시 패턴의 의도 : 다른 개체에 대한 접근을 제어하기 위해 대리자를 제공
- 데코레이터 패턴의 의도 : 객체의 추가 책임을 동적으로 추가하고 기능 확장을 위한 유연한 대안 제공

### 5. 인터페이스 기반 프록시
- 프록시 사용 -> 기존 코드를 전혀 수정하지 않고 로그 추적 기능 도입 가능
- 인터페이스만 같으면 모든 곳에 적용 가능

### 6. 구체 클래스 기반 프록시
- 클래스 기반 프록시 도입
- 해당 클래스에만 적용 가능
- 부모 클래스 생성자 호출 필요
- final 키워드 사용시 상속 불가/메서드 오버라이딩 불가

## 5. 동적 프록시 기술

### 1. 리플렉션
- 클래스나 메서드의 메타 정보를 사용해서 동적으로 호출하는 메서드 변경 가능
- 런타임에 동작 -> 컴파일 시점에 오류 잡기 불가

### 2. JDK 동적 프록시
- 개발자가 직접 프록시 클래스 만들지 않아도 됨
- 프록시 객체를 동적으로 런타임에 개발자 대신 만들어줌
- 원하는 실행 로직 지정 가능
- 인터페이스 필수

### 3. CGLIB
- CGLIB(Code Generator Library)
  - 바이트코드를 조작해서 동적으로 클래스를 생성하는 기술을 제공하는 라이브러리
  - 인터페이스 없이 구체 클래스만 가지고 동적 프록시 생성 가능
  - 스프링 프레임워크 -> 스프링 내부 소스 코드에 포함
- MethodInterceptor 제공

## 6. 스프링이 지원하는 프록시

### 1. 프록시 팩토리
- 동적 프록시를 통합해서 편리하게 만들어줌
- 인터페이스 존재 -> JDK 동적 프록시 사용
- 구체 클래스 존재 -> CGLIB 사용
- Advice -> 부가 기능 적용

### 2. 포인트컷, 어드바이스, 어드바이저
- 포인트컷 : 부가 기능을 어디에 적용/미적용 판단하는 필터링 로직, 클래스와 메서드 이름으로 필터링
- 어드바이스 : 프록시가 호출하는 부가 기능
- 어드바이저 : 하나의 포인트컷과 하나의 어드바이스를 가지고 있음
- 프록시 팩토리 -> 여러 어드바이저 적용 가능

## 7. 빈 후처리기

### 1. 빈 후처리기
- 빈을 생성한 후에 무언가를 처리하는 용도로 사용
- 객체 조작/완전히 다른 객체로 변환 가능
- 실제 객체 대신 프록시 -> 스프링 빈 등록 가능

### 2. 스프링이 제공하는 빈 후처리기
- 자동 프록시 생성기 : AutoProxyCreator
- 프록시 적용 여부 판단 -> 생성 단계
- 어드바이스 적용 여부 판단 -> 사용 단계

## 8. @Aspect AOP

### 1. @Aspect 프록시
- 포인트컷과 어드바이스로 구성되어 있는 어드바이저 생성 기능 지원
- 프록시를 통한 AOP 가능
- @Aspect를 어드바이저로 변환해서 저장하는 과정
- 어드바이저를 기반으로 프록시 생성

## 9. 스프링 AOP 개념

### 1. AOP 소개 - 핵심 기능과 부가 기능
- 핵심 기능 : 해당 객체가 제공하는 고유 기능
- 부가 기능 : 핵심 기능을 보조하기 위해 제공되는 기능

### 2. AOP 소개 - 애스펙트
- 부가 기능과 부가 기능을 어디에 적용할지 정의한 것
- 애플리케이션을 바라보는 관점 : 하나의 기능 -> 횡단 관심사 관점으로 전환
- AOP(Aspect-Oriented Programming) : 관점 지향 프로그래밍, OOP의 부족한 부분 보조 목적
- AspectJ : 자바 프로그래밍 언어에 대한 완벽한 관점 지향 확장, 횡단 관심사의 깔끔한 모듈화
  - 오류 검사 및 처리
  - 동기화
  - 성능 최적화(캐싱)
  - 모니터링 및 로깅

### 3. AOP 적용 방식
- 컴파일 시점 -> 위빙 : 원본 로직에 부가 기능 로직이 추가되는 것
- 클래스 로딩 시점 -> 로드 타임 위빙 : 자바를 실행할 때 특별한 옵션을 통해 클래스 로더 조작기 지정 필요
- 런타임 시점 -> 런타임 위빙 : 프록시 사용으로 인한 AOP 기능 일부 제약

### 4. AOP 용어 정리
- 조인 포인트
  - 어드바이스가 적용될 수 있는 위치, 메서드 실행, 생성자 호출, 필드값 접근, static 메서드 접근같은 프로그램 실행 중 지점
  - AOP를 적용할 수 있는 모든 지점
  - 항상 메서드 실행 지점으로 제한
- 포인트컷
  - 조인 포인트 중에서 어드바이스가 적용될 위치를 선별하는 기능
  - AspectJ 표현식을 사용해서 지정
  - 프록시를 사용하는 스프링 AOP는 메서드 실행 지점만 포인트것으로 선별 가능
- 타겟 : 어드바이스를 받는 객체, 포인트컷으로 지정
- 어드바이스
  - 부가 기능
  - 특정 조인 포인트에서 Aspect에 의해 취해지는 조치
  - Around, Before, After 등
- 애스펙트
  - 어드바이스 + 포인트컷 모듈화
  - @Aspect
- 어드바이저
  - 하나의 어드바이스와 하나의 포인트컷
  - 스프링 AOP에서만 사용
- 위빙
  - 포인트컷으로 결정한 타겟의 조인 포인트에 어드바이스를 적용하는 것
  - 핵심 기능 코드에 영향을 주지 않고 부가 기능 추가 가능
  - AOP 적용을 위해 애스펙트를 객체에 연결한 상태
- AOP 프록시 : AOP 기능을 구현하기 위해 만든 프록시 객체